#!/usr/bin/env php
<?php
use Wandu\Foundation\Application;
use Wandu\Foundation\Definitions\NeedInstallDefinition;
use Wandu\Foundation\Kernels\ConsoleKernel;

if (is_file(__DIR__ . '/../vendor/autoload.php')) { // in /bin/wandu
    define('WANDU_PATH', realpath(__DIR__ . '/..'));
} elseif (is_file(__DIR__ . '/../../../../vendor/autoload.php')) { // in /vendor/wandu/framework/bin/wandu
    define('WANDU_PATH', realpath(__DIR__ . '/../../../..'));
} elseif (is_file(__DIR__ . '/../../vendor/autoload.php')) { // in /vendor/bin/wandu
    define('WANDU_PATH', realpath(__DIR__ . '/../..'));
} else {
    echo "cannot find autoload.php. you may run composer install.\n";
    exit(-1);
}
require_once WANDU_PATH . '/vendor/autoload.php';

$definePath = getcwd() . '/.wandu.php';
if (file_exists($definePath)) {
    $definition = require $definePath;
} else {
    $definition = new NeedInstallDefinition();
}

$app = new Application(new ConsoleKernel($definition));
$app->instance('base_path', WANDU_PATH);
exit($app->execute());
